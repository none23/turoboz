include ../mixins.jade
include tour_mixins.jade

mixin TagInfo(tagObj)
    .tours-tag-info__wrap
        .tours-tag-info
            | {{ #{tagObj}.description | markdownify }}

section.tours_list__wrap
    h2.section_header.tours__section_header
        | Экскурсии{% unless page.url == '/tours/' %}: {% endunless %}{% for tag in site.data.tags %}{% if tag.url == page.url %}{{ tag.title }}{% elsif page.url contains tag.url %}{% for subtag in tag.subtags %}{% if subtag.url == page.url %}{{ subtag.title }}{% endif %}{% endfor %}{% endif %}{% endfor %}
    | {% assign purl = page.url %}{% if purl == '/tours/'%}
    +ToursList()
    | {% else %}{% for tag in site.data.tags %}{% if purl == tag.url %}{% if tag.description.size >= 1 %}
    +TagInfo('tag')
    | {% endif %}
    +ToursList('tag.tag')
    | {% endif %}{% if tag.subtags %}{% for subtag in tag.subtags %}{% if purl == subtag.url %}{% if subtag.description.size >= 1 %}
    +TagInfo('subtag')
    | {% elsif tag.description.size >= 1 %}
    +TagInfo('tag')
    | {% endif %}
    +ToursList('subtag.subtag')
    | {% endif %}{% endfor %}{% endif %}{% endfor %}{% endif %}

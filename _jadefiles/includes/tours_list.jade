include ../mixins.jade
//-- tour {{{
mixin Tour(tour)
        | {% assign tours_on_page_counter = tours_on_page_counter | plus: 1 %}
        .tour__wrap
            a.tour__card(tabindex=1, href="{{ #{tour}.id }}")
                picture.tour__image__wrap
                    img.tour__image(src='/img/tours300/{{ #{tour}.imgpath }}', alt='{{ #{tour}.title }}')

                .tour__date
                    | {% if #{tour}.dates[0] | plus: 0 > 10 %} 
                    +LiquidRussianDate('#{tour}.dates[0]')
                    | {% else %} по заказу {% endif %}

                .tour__length
                    | {{ #{tour}.tourlength }}
                    
                h3.tour__title
                    | {{ #{tour}.title }} 
                    | {{ #{tour}.subtitle }} 

                //--.tour__prices
                //--    .tour__label
                //--        | Стоимость:
                //--    | {% for item in #{tour}.prices %}
                //--    | {{ item }}
                //--    | {% endfor %}
                .tour__link
                    | Подробнее

//--/tour }}}
//-- tours_list {{{
mixin ToursList( activeFilter='' )
    .tours_list
        | {% for tour in site.tours %}
        | {% assign tours_total_counter = tours_total_counter | plus: 1 %}
        if activeFilter
            | {% for x in tour.tags %}
            |   {% if x == #{activeFilter} %}
            +Tour('tour')
            |   {% endif %}
            | {% endfor %}
        else
            +Tour('tour')
        | {% endfor %}

    .tours__count
        span Показано: 
        span.tours__on_page
            |  {{ tours_on_page_counter }}
        span  / 
        span.tours__total
            | {{ tours_total_counter }}
        span  экскурсий


//--/tours__list }}}
//-- Page Logic {{{
section.tours_list__wrap
    h2.section_header.tours__list__section_header
        |  Экскурсии{% unless page.url == '/tours/' %}: {% endunless %}{% for tag in site.data.tags %}{% if tag.url == page.url %}{{ tag.title }}{% elsif page.url contains tag.url %}{% for subtag in tag.subtags %}{% if subtag.url == page.url %}{{ subtag.title }}{% endif %}{% endfor %}{% endif %}{% endfor %}
    | {% assign purl = page.url %}
    | {% if purl == '/tours/'%}
    +ToursList()
    | {% else %}
    |  {% for tag in site.data.tags %}
    |   {% if purl == tag.url %}
    +ToursList('tag.tag')
    |   {% endif %}
    |   {% if tag.subtags %}
    |    {% for subtag in tag.subtags %}
    |     {% if purl == subtag.url %}
    +ToursList('subtag.subtag')
    |     {% endif %}
    |    {% endfor %}
    |   {% endif %}
    |  {% endfor %}
    | {% endif %}

//-- /Page Logic }}}

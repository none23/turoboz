include ../mixins.jade
//-- tour {{{
mixin Tour(tour)
        | {% assign tours_on_page_counter = tours_on_page_counter | plus: 1 %}
        a.tour__wrap(tabindex=1, href="{{ #{tour}.tour }}")
            .tour__fixed
                picture.tour__image__wrap
                    img.tour__image(src='/img/tours400/{{ #{tour}.imgpath }}', alt='{{ #{tour}.title }}')
                .tour__date
                    | {% if #{tour}.dates[0] | plus: 0 > 10 %} 
                    +LiquidRussianDate('#{tour}.dates[0]')
                    | {% else %} по заказу {% endif %}
                    
                h3.tour__title
                    | {{ #{tour}.title }} 
                    | {{ #{tour}.subtitle }} 
                .tour__link
                    | Подробнее

            .tour__moving
                .tour__length
                    | Продолжительность:
                    | {{ #{tour}.tourlength }}
                p.tour__intro
                    | {{ #{tour}.intro }}
                p.tour__summary
                    | {{ #{tour}.summary }}

//--/tour }}}
//-- tours__list {{{
mixin ToursList( activeFilter='' )
    .tours__list
        | {% for tour in site.tours %}
        | {% assign tours_total_counter = tours_total_counter | plus: 1 %}
        if activeFilter
            | {% for x in tour.tags %}
            |   {% if x == #{activeFilter} %}
            +Tour('tour')
            |   {% endif %}
            | {% endfor %}
        else
            +Tour('tour')
        | {% endfor %}

    .tours__count
        span Показано: 
        span.tours__on_page
            |  {{ tours_on_page_counter }}
        span  / 
        span.tours__total
            | {{ tours_total_counter }}
        span  экскурсий


//--/tours__list }}}
//-- Page Logic {{{
section.tours_list__wrap
    | {% assign purl = page.url %}
    | {% if purl == '/tours/'%}
    +ToursList()
    | {% else %}
    |  {% for tag in site.data.tags %}
    |   {% if purl == tag.url %}
    +ToursList('tag.tag')
    |   {% endif %}
    |   {% if tag.subtags %}
    |    {% for subtag in tag.subtags %}
    |     {% if purl == subtag.url %}
    +ToursList('subtag.subtag')
    |     {% endif %}
    |    {% endfor %}
    |   {% endif %}
    |  {% endfor %}
    | {% endif %}

//-- /Page Logic }}}

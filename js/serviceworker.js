"use strict";function reset(){dataElement.textContent="",cacheStatus.textContent="",networkStatus.textContent="",gotNetworkData=!1}function disableUI(){getDataButton.disabled=!0,cacheDelayInput.disabled=!0,cacheFailInput.disabled=!0,networkDelayInput.disabled=!0,networkFailInput.disabled=!0,reset()}function enableUI(){getDataButton.disabled=!1,cacheDelayInput.disabled=!1,cacheFailInput.disabled=!1,networkDelayInput.disabled=!1,networkFailInput.disabled=!1}function updatePage(t){dataElement.textContent="User "+t[0].actor.login+" modified repo "+t[0].repo.name}function handleFetchCompletion(t){var e=networkFailInput.checked;if(e)throw new Error("Network error");var n=t.clone();caches.open(cacheName).then(function(t){t.put(dataUrl,n)}),t.json().then(function(t){updatePage(t),gotNetworkData=!0})}function handleCacheFetchCompletion(t){var e=cacheFailInput.checked;if(e||!t)throw Error("Cache miss");t.json().then(function(t){gotNetworkData||updatePage(t)})}var dataUrl="https://api.github.com/events",cacheDelayInput=document.getElementById("cache-delay"),cacheFailInput=document.getElementById("cache-fail"),networkDelayInput=document.getElementById("network-delay"),networkFailInput=document.getElementById("network-fail"),cacheStatus=document.getElementById("cache-status"),networkStatus=document.getElementById("network-status"),getDataButton=document.getElementById("getDataButton"),dataElement=document.getElementById("data"),cacheName="cache-then-network",gotNetworkData=!1,networkFetchStartTime,cacheFetchStartTime;getDataButton.addEventListener("click",function(){disableUI(),networkStatus.textContent="Fetching...",networkFetchStartTime=Date.now();var t=Date.now(),e=fetch(dataUrl+"?cacheBuster="+t,{mode:"cors",cache:"no-cache"}).then(function(t){var e=networkDelayInput.value||0;return new Promise(function(n,a){setTimeout(function(){try{handleFetchCompletion(t),n()}catch(t){a(t)}},e)})}).then(function(){var t=Date.now(),e=t-networkFetchStartTime;networkStatus.textContent="Success after "+e+"ms"}).catch(function(t){var e=Date.now(),n=e-networkFetchStartTime;networkStatus.textContent=t+" after "+n+"ms"});cacheStatus.textContent="Fetching...",cacheFetchStartTime=Date.now();var n=caches.open(cacheName).then(function(t){return t.match(dataUrl).then(function(t){var e=cacheDelayInput.value||0;return new Promise(function(n,a){setTimeout(function(){try{handleCacheFetchCompletion(t),n()}catch(t){a(t)}},e)})}).then(function(){var t=Date.now(),e=t-cacheFetchStartTime;cacheStatus.textContent="Success after "+e+"ms"}).catch(function(t){var e=Date.now(),n=e-cacheFetchStartTime;cacheStatus.textContent=t+" after "+n+"ms"})});Promise.all([e,n]).then(enableUI)});